<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø´ØºÙ„Ù†ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap');
        
        * { font-family: 'Tajawal', sans-serif; }
        
        body { background-color: #f8fafc; }
        
        .gradient-bg { background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© */
        .stat-card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e2e8f0;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #3b82f6, #1d4ed8);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.15);
        }
        
        .stat-card.green::before { background: linear-gradient(to bottom, #10b981, #059669); }
        .stat-card.orange::before { background: linear-gradient(to bottom, #f59e0b, #d97706); }
        .stat-card.purple::before { background: linear-gradient(to bottom, #8b5cf6, #7c3aed); }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ */
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform-origin: 50% 50%;
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙˆØ¸Ø§Ø¦Ù */
        .job-card {
            background: white;
            border-radius: 1rem;
            padding: 1.25rem;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .job-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }
        
        .job-card.featured {
            border-right: 4px solid #3b82f6;
        }
        
        /* Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification-item {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: start;
            gap: 0.75rem;
            transition: all 0.2s;
        }
        
        .notification-item:hover {
            background-color: #f1f5f9;
        }
        
        .notification-item.success { background-color: #f0fdf4; border-right: 3px solid #10b981; }
        .notification-item.info { background-color: #eff6ff; border-right: 3px solid #3b82f6; }
        .notification-item.warning { background-color: #fffbeb; border-right: 3px solid #f59e0b; }
        
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        #mobile-menu {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        #mobile-menu.open {
            transform: translateX(0);
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            border-radius: 0.75rem;
            color: #64748b;
            transition: all 0.2s;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        
        .sidebar-item:hover, .sidebar-item.active {
            background-color: #eff6ff;
            color: #2563eb;
        }
        
        .sidebar-item.active {
            font-weight: 700;
        }
        
        .badge {
            background-color: #ef4444;
            color: white;
            font-size: 0.75rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-weight: 700;
        }
        
        /* Ø²Ø± Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… */
        .apply-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .apply-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .dashboard-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease forwards;
        }
        
        /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© */
        .auth-required {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="main-content" style="display: none;">
        
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="dashboard-header flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="index.html">
                    <img src="shagelnie.png.png" alt="Ø´ØºÙ„Ù†ÙŠ" class="h-10">
                </a>
                <h1 class="text-xl font-bold text-gray-800 hidden md:block">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <button class="relative p-2 text-gray-500 hover:text-blue-600 transition" onclick="showNotifications()">
                    <i class="fas fa-bell text-xl"></i>
                    <span id="notif-count" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">0</span>
                </button>
                
                <div class="flex items-center gap-3 border-r pr-4 border-gray-200 cursor-pointer" onclick="toggleUserMenu()">
                    <div class="text-right hidden sm:block">
                        <p id="user-name" class="font-bold text-sm">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                        <p id="user-role" class="text-xs text-gray-500">...</p>
                    </div>
                    <img id="user-avatar" src="https://via.placeholder.com/100" alt="Ø§Ù„ØµÙˆØ±Ø©" class="w-10 h-10 rounded-full border-2 border-blue-100 object-cover">
                </div>
                
                <button class="md:hidden text-gray-600" onclick="toggleSidebar()">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </header>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© -->
        <div id="user-menu" class="hidden absolute top-16 left-4 bg-white rounded-xl shadow-lg border border-gray-200 p-2 z-50 w-48">
            <a href="profile.html" class="block px-4 py-2 hover:bg-gray-50 rounded-lg text-sm">Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</a>
            <a href="settings.html" class="block px-4 py-2 hover:bg-gray-50 rounded-lg text-sm">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
            <hr class="my-2">
            <button onclick="logout()" class="block w-full text-right px-4 py-2 hover:bg-red-50 text-red-600 rounded-lg text-sm">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="flex min-h-screen">
            <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
            <aside id="sidebar" class="w-64 bg-white border-l border-gray-200 p-4 fixed md:sticky top-[73px] h-[calc(100vh-73px)] overflow-y-auto transform translate-x-full md:translate-x-0 transition-transform z-40">
                <div class="mb-6">
                    <div class="sidebar-item active" onclick="showSection('dashboard')">
                        <i class="fas fa-home w-5"></i>
                        <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='profile.html'">
                        <i class="fas fa-user w-5"></i>
                        <span>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</span>
                    </div>
                    <div class="sidebar-item" onclick="window.location.href='job_listing_page.html'">
                        <i class="fas fa-search w-5"></i>
                        <span>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØ©</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('applications')">
                        <i class="fas fa-paper-plane w-5"></i>
                        <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</span>
                        <span id="sidebar-badge" class="badge mr-auto hidden">0</span>
                    </div>
                    <div class="sidebar-item" onclick="showSection('saved')">
                        <i class="fas fa-bookmark w-5"></i>
                        <span>ÙˆØ¸Ø§Ø¦Ù Ù…Ø­ÙÙˆØ¸Ø©</span>
                    </div>
                </div>
                
                <div class="border-t pt-4 mt-4">
                    <div class="sidebar-item text-gray-600 hover:bg-gray-50" onclick="window.location.href='settings.html'">
                        <i class="fas fa-cog w-5"></i>
                        <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </div>
                    <div class="sidebar-item text-red-600 hover:bg-red-50" onclick="logout()">
                        <i class="fas fa-sign-out-alt w-5"></i>
                        <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                    </div>
                </div>
            </aside>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <main class="flex-1 p-4 md:p-6 max-w-7xl mx-auto w-full">
                
                <!-- Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
                <div class="mb-8 animate-slide-in">
                    <h2 class="text-2xl font-black text-gray-800 mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span id="welcome-name">...</span>! ğŸ‘‹</h2>
                    <p class="text-gray-500">Ù„Ø¯ÙŠÙƒ <span class="text-blue-600 font-bold" id="new-jobs-count">0 ÙˆØ¸Ø§Ø¦Ù</span> Ø¬Ø¯ÙŠØ¯Ø© ØªØ·Ø§Ø¨Ù‚ Ù…Ù‡Ø§Ø±Ø§ØªÙƒ</p>
                </div>

                <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="stat-card orange animate-slide-in" style="animation-delay: 0.1s">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm mb-1">Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„/Ø§Ù„Ù‚Ø¨ÙˆÙ„</p>
                                <p class="text-3xl font-black text-gray-800" id="offers-count">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center text-orange-600">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">ÙˆØ¸ÙŠÙØªØ§Ù† ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø©</p>
                    </div>

                    <div class="stat-card green animate-slide-in" style="animation-delay: 0.2s">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm mb-1">Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ù…Ù„ÙÙƒ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
                                <p class="text-3xl font-black text-gray-800" id="views-count">0</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                                <i class="fas fa-eye text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-green-600 mt-2 font-bold">+12% Ø¹Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ</p>
                    </div>

                    <div class="stat-card purple animate-slide-in" style="animation-delay: 0.3s">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-500 text-sm mb-1">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</p>
                                <p class="text-3xl font-black text-gray-800" id="applications-count">0</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                                <i class="fas fa-paper-plane text-xl"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2" id="pending-text">0 ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯</p>
                    </div>
                </div>

                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
                <div class="bg-white rounded-2xl p-6 mb-8 border border-gray-200 animate-slide-in" style="animation-delay: 0.4s">
                    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <div class="relative w-20 h-20">
                                <svg class="progress-ring w-20 h-20">
                                    <circle class="text-gray-200" stroke-width="6" stroke="currentColor" fill="transparent" r="32" cx="40" cy="40"/>
                                    <circle id="progress-circle" class="text-blue-600 progress-ring-circle" stroke-width="6" stroke-linecap="round" stroke="currentColor" fill="transparent" r="32" cx="40" cy="40" 
                                        stroke-dasharray="201.06" stroke-dashoffset="201.06"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-lg font-bold text-blue-600" id="profile-percent">0%</span>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg mb-1">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                                <p class="text-gray-500 text-sm" id="profile-hint">Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµÙƒ</p>
                            </div>
                        </div>
                        <a href="profile.html" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-700 transition w-full md:w-auto text-center">
                            ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙŠ Ø§Ù„Ø¢Ù†
                        </a>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <!-- Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
                    <div class="lg:col-span-1 animate-slide-in" style="animation-delay: 0.5s">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i class="fas fa-bell text-blue-600"></i>
                            Ø¢Ø®Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                        </h3>
                        
                        <div class="bg-white rounded-2xl p-4 border border-gray-200" id="notifications-container">
                            <p class="text-gray-400 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                        </div>
                    </div>

                    <!-- Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© -->
                    <div class="lg:col-span-2 animate-slide-in" style="animation-delay: 0.6s">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg flex items-center gap-2">
                                <i class="fas fa-briefcase text-blue-600"></i>
                                Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ
                            </h3>
                            <a href="job_listing_page.html" class="text-blue-600 text-sm font-bold hover:underline flex items-center gap-1">
                                Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                                <i class="fas fa-arrow-left text-xs"></i>
                            </a>
                        </div>

                        <div class="space-y-4" id="jobs-container">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ù…Ù† Firebase -->
                            <div class="text-center py-8">
                                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent"></div>
                                <p class="text-gray-400 mt-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <div id="auth-required" class="auth-required hidden">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-md mx-4">
            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-lock text-3xl text-blue-600"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨</h2>
            <p class="text-gray-600 mb-6">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
            <div class="flex gap-3">
                <a href="login.html" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                <a href="index.html" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200 transition">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, doc, getDoc, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ÙÙŠ index.html
        const firebaseConfig = {
            apiKey: "AIzaSyBsIaCjE7QOQ6QkhqhCIMA3sLdMvxBxPHk",
            authDomain: "shaglni-c64c0.firebaseapp.com",
            projectId: "shaglni-c64c0",
            storageBucket: "shaglni-c64c0.firebasestorage.app",
            messagingSenderId: "768887356636",
            appId: "1:768887356636:web:11ec1d6991add3309c8819"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let userData = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        onAuthStateChanged(auth, async (user) => {
            document.getElementById('loading').style.display = 'none';
            
            if (user) {
                currentUser = user;
                document.getElementById('main-content').style.display = 'block';
                document.getElementById('auth-required').classList.add('hidden');
                
                await loadUserData(user.uid);
                await loadDashboardData(user.uid);
            } else {
                document.getElementById('main-content').style.display = 'none';
                document.getElementById('auth-required').classList.remove('hidden');
            }
        });

        async function loadUserData(userId) {
            try {
                // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
                const userDoc = await getDoc(doc(db, "users", userId));
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    document.getElementById('user-name').textContent = userData.name || userData.email || 'Ù…Ø³ØªØ®Ø¯Ù…';
                    document.getElementById('welcome-name').textContent = userData.name || 'Ø²Ø§Ø¦Ø±';
                    document.getElementById('user-role').textContent = userData.headline || userData.userType || 'Ø¨Ø§Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„';
                    
                    if (userData.profileImageUrl) {
                        document.getElementById('user-avatar').src = userData.profileImageUrl;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù„Ù
                    const completion = calculateProfileCompletion(userData);
                    updateProgressCircle(completion);
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }

        function calculateProfileCompletion(data) {
            let fields = 0;
            let completed = 0;
            
            const requiredFields = ['name', 'email', 'phone', 'headline', 'skills', 'profileImageUrl', 'bio'];
            requiredFields.forEach(field => {
                fields++;
                if (data[field] && (Array.isArray(data[field]) ? data[field].length > 0 : true)) {
                    completed++;
                }
            });
            
            return Math.round((completed / fields) * 100);
        }

        function updateProgressCircle(percent) {
            const circle = document.getElementById('progress-circle');
            const radius = 32;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            document.getElementById('profile-percent').textContent = percent + '%';
            
            const hint = document.getElementById('profile-hint');
            if (percent < 50) {
                hint.textContent = 'Ø£Ø¶Ù Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø²ÙŠØ§Ø¯Ø© ÙØ±ØµÙƒ';
                circle.classList.remove('text-green-500');
                circle.classList.add('text-blue-600');
            } else if (percent < 80) {
                hint.textContent = 'Ù…Ù„ÙÙƒ Ø¬ÙŠØ¯ØŒ Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
                circle.classList.remove('text-blue-600');
                circle.classList.add('text-yellow-500');
            } else {
                hint.textContent = 'Ù…Ù„ÙÙƒ Ù…ÙƒØªÙ…Ù„ ÙˆÙ…Ù…ØªØ§Ø²!';
                circle.classList.remove('text-yellow-500');
                circle.classList.add('text-green-500');
            }
        }

        async function loadDashboardData(userId) {
            try {
                // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                await loadStats(userId);
                
                // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                await loadNotifications(userId);
                
                // 3. Ø¬Ù„Ø¨ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©
                if (userData && userData.skills) {
                    await loadRecommendedJobs(userData.skills);
                } else {
                    await loadAllJobs();
                }
                
            } catch (error) {
                console.error("Error loading dashboard:", error);
            }
        }

        async function loadStats(userId) {
            // Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
            const appsQuery = query(collection(db, "applications"), where("userId", "==", userId));
            const appsSnapshot = await getDocs(appsQuery);
            document.getElementById('applications-count').textContent = appsSnapshot.size;
            
            // Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù‚ Ù…Ù†Ù‡Ø§
            const pending = appsSnapshot.docs.filter(d => d.data().status === 'pending').length;
            document.getElementById('pending-text').textContent = `${pending} ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯`;
            
            // Ø¹Ø¯Ø¯ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹)
            try {
                const viewsDoc = await getDoc(doc(db, "profileViews", userId));
                document.getElementById('views-count').textContent = viewsDoc.exists() ? viewsDoc.data().count : 0;
            } catch (e) {
                document.getElementById('views-count').textContent = '0';
            }
            
            // Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ù…Ù„
            const offersQuery = query(collection(db, "jobOffers"), where("userId", "==", userId), where("status", "==", "pending"));
            const offersSnapshot = await getDocs(offersQuery);
            document.getElementById('offers-count').textContent = offersSnapshot.size;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            if (appsSnapshot.size > 0) {
                const badge = document.getElementById('sidebar-badge');
                badge.textContent = appsSnapshot.size;
                badge.classList.remove('hidden');
            }
        }

        async function loadNotifications(userId) {
            const notifQuery = query(
                collection(db, "notifications"), 
                where("userId", "==", userId),
                orderBy("createdAt", "desc"),
                limit(5)
            );
            
            const container = document.getElementById('notifications-container');
            
            onSnapshot(notifQuery, (snapshot) => {
                const count = snapshot.size;
                const countBadge = document.getElementById('notif-count');
                
                if (count > 0) {
                    countBadge.textContent = count;
                    countBadge.classList.remove('hidden');
                }
                
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-400 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>';
                    return;
                }
                
                container.innerHTML = '';
                snapshot.forEach((doc) => {
                    const notif = doc.data();
                    const div = document.createElement('div');
                    div.className = `notification-item ${notif.type || 'info'}`;
                    div.innerHTML = `
                        <div class="w-10 h-10 bg-${getNotifColor(notif.type)}-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas ${getNotifIcon(notif.type)} text-${getNotifColor(notif.type)}-600"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-bold text-gray-800 mb-1">${notif.title}</p>
                            <p class="text-xs text-gray-600">${notif.message}</p>
                            <p class="text-xs text-gray-400 mt-1">${formatTime(notif.createdAt)}</p>
                        </div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        function getNotifIcon(type) {
            const icons = {
                'success': 'fa-check',
                'message': 'fa-envelope',
                'warning': 'fa-star',
                'info': 'fa-info'
            };
            return icons[type] || 'fa-bell';
        }

        function getNotifColor(type) {
            const colors = {
                'success': 'green',
                'message': 'blue',
                'warning': 'yellow',
                'info': 'blue'
            };
            return colors[type] || 'gray';
        }

        async function loadRecommendedJobs(skills) {
            const container = document.getElementById('jobs-container');
            container.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-600 border-t-transparent"></div></div>';
            
            try {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸Ø§Ø¦Ù ØªØªØ·Ù„Ø¨ Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const jobsQuery = query(
                    collection(db, "jobs"),
                    where("skills", "array-contains-any", skills.slice(0, 10)),
                    where("status", "==", "active"),
                    limit(5)
                );
                
                const snapshot = await getDocs(jobsQuery);
                renderJobs(snapshot);
                
                document.getElementById('new-jobs-count').textContent = snapshot.size + ' ÙˆØ¸Ø§Ø¦Ù';
                
            } catch (error) {
                // Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ù…Ø¹Ù‚Ø¯ØŒ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
                await loadAllJobs();
            }
        }

        async function loadAllJobs() {
            const jobsQuery = query(collection(db, "jobs"), where("status", "==", "active"), limit(5));
            const snapshot = await getDocs(jobsQuery);
            renderJobs(snapshot);
            document.getElementById('new-jobs-count').textContent = snapshot.size + ' ÙˆØ¸Ø§Ø¦Ù';
        }

        function renderJobs(snapshot) {
            const container = document.getElementById('jobs-container');
            container.innerHTML = '';
            
            if (snapshot.empty) {
                container.innerHTML = '<p class="text-gray-400 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>';
                return;
            }
            
            snapshot.forEach((doc) => {
                const job = doc.data();
                const card = createJobCard(job, doc.id);
                container.innerHTML += card;
            });
        }

        function createJobCard(job, jobId) {
            const isFeatured = job.featured || false;
            const salary = job.salary ? `${job.salary.min} - ${job.salary.max} ${job.salary.currency || '$'}` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            return `
                <div class="job-card ${isFeatured ? 'featured' : ''}">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex gap-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-blue-600 flex-shrink-0">
                                ${job.companyLogo ? `<img src="${job.companyLogo}" class="w-full h-full object-cover rounded-xl">` : '<i class="fas fa-building text-xl"></i>'}
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-1">${job.title}</h4>
                                <p class="text-blue-600 text-sm font-medium">${job.companyName}</p>
                            </div>
                        </div>
                        <button onclick="saveJob('${jobId}')" class="text-gray-400 hover:text-blue-600 transition">
                            <i class="far fa-bookmark text-xl"></i>
                        </button>
                    </div>
                    
                    <div class="flex flex-wrap gap-2 mb-3 text-xs text-gray-500">
                        <span class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-lg">
                            <i class="fas fa-map-marker-alt"></i> ${job.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </span>
                        <span class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-lg">
                            <i class="fas fa-clock"></i> ${job.type === 'full-time' ? 'Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„' : job.type === 'part-time' ? 'Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ' : 'Ù…Ø´Ø±ÙˆØ¹'}
                        </span>
                        <span class="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-lg">
                            <i class="fas fa-briefcase"></i> ${job.experience || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </span>
                    </div>
                    
                    <div class="flex justify-between items-center">
                        <span class="text-green-600 font-bold">${salary} / Ø´Ù‡Ø±</span>
                        <button onclick="applyJob('${jobId}')" class="apply-btn">Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¢Ù†</button>
                    </div>
                </div>
            `;
        }

        function formatTime(timestamp) {
            if (!timestamp) return 'Ø§Ù„Ø¢Ù†';
            const date = timestamp.toDate();
            const now = new Date();
            const diff = Math.floor((now - date) / 1000 / 60); // Ø¯Ù‚Ø§Ø¦Ù‚
            
            if (diff < 1) return 'Ø§Ù„Ø¢Ù†';
            if (diff < 60) return `Ù…Ù†Ø° ${diff} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (diff < 1440) return `Ù…Ù†Ø° ${Math.floor(diff/60)} Ø³Ø§Ø¹Ø©`;
            return `Ù…Ù†Ø° ${Math.floor(diff/1440)} ÙŠÙˆÙ…`;
        }

        // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø§Ù…Ø©
        window.toggleSidebar = function() {
            document.getElementById('sidebar').classList.toggle('translate-x-full');
        };

        window.toggleUserMenu = function() {
            document.getElementById('user-menu').classList.toggle('hidden');
        };

        window.showNotifications = function() {
            // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£Ùˆ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ modal
            alert('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
        };

        window.saveJob = async function(jobId) {
            if (!currentUser) return;
            
            try {
                await addDoc(collection(db, "savedJobs"), {
                    userId: currentUser.uid,
                    jobId: jobId,
                    savedAt: new Date()
                });
                alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error("Error saving job:", error);
            }
        };

        window.applyJob = async function(jobId) {
            if (!currentUser) {
                alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            try {
                await addDoc(collection(db, "applications"), {
                    userId: currentUser.uid,
                    jobId: jobId,
                    status: 'pending',
                    appliedAt: new Date()
                });
                alert('ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                console.error("Error applying:", error);
            }
        };

        window.logout = async function() {
            try {
                await signOut(auth);
                window.location.href = 'index.html';
            } catch (error) {
                console.error("Error signing out:", error);
            }
        };

        window.showSection = function(section) {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ù‚Ø³Ø§Ù… Ù…Ø®ØªÙ„ÙØ©
            console.log('Showing section:', section);
        };

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('user-menu');
            const sidebar = document.getElementById('sidebar');
            
            if (!event.target.closest('#user-menu') && !event.target.closest('.cursor-pointer')) {
                userMenu.classList.add('hidden');
            }
        });

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        import { addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    </script>
</body>
</html>
