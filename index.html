<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شغلني - بوابة التوظيف السودانية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; }
        
        .gradient-bg { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); }
        
        /* تنسيق بطاقة الموظف */
        .employee-card {
            background: white;
            border-radius: 1.25rem;
            padding: 1.5rem;
            border: 1px solid #f1f5f9;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .employee-card:hover { 
            transform: translateY(-10px); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); 
        }
        
        .skill-tag {
            background-color: #eff6ff; color: #1e40af;
            padding: 0.25rem 0.6rem; border-radius: 8px; font-size: 0.75rem; font-weight: 500;
        }

        /* تنسيق شبكة صور الأعمال المصغرة */
        .portfolio-mini-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .portfolio-img-container {
            aspect-ratio: 1 / 1;
            overflow: hidden;
            border-radius: 0.75rem;
            background-color: #f8fafc;
            border: 1px solid #f1f5f9;
        }
        .portfolio-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .employee-card:hover .portfolio-img { transform: scale(1.1); }

        .status-available { background-color: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; }
    </style>
</head>
<body class="bg-slate-50">

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center">
                <div class="text-2xl font-black text-blue-600 ml-8">شغلني</div>
                <div class="hidden md:flex space-x-2 space-x-reverse">
                    <a href="index.html" class="px-4 py-2 text-blue-600 font-bold border-b-2 border-blue-600">الرئيسية</a>
                    <a href="job_listing_page.html" class="px-4 py-2 text-gray-600 hover:text-blue-600 transition">الوظائف</a>
                    <a href="employee_listing_page.html" class="px-4 py-2 text-gray-600 hover:text-blue-600 transition">الموظفون</a>
                </div>
            </div>
            <a href="login.html" class="px-6 py-2 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-md shadow-blue-200">دخول</a>
        </nav>
    </header>

    <section class="gradient-bg text-white py-20 px-6 text-center">
        <h1 class="text-4xl md:text-6xl font-black mb-6 leading-tight">سوق العمل السوداني <br>في مكان واحد</h1>
        <p class="text-lg opacity-80 mb-10 max-w-2xl mx-auto font-light">اكتشف المبدعين السودانيين أو ابحث عن وظيفة أحلامك في أكبر شبكة مهنية سودانية.</p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <a href="job_listing_page.html" class="bg-white text-blue-700 px-10 py-4 rounded-2xl font-bold shadow-xl hover:bg-gray-100 transition flex items-center justify-center">
                <i class="fas fa-search-dollar ml-2"></i> ابحث عن عمل
            </a>
            <a href="employee_listing_page.html" class="bg-blue-500 bg-opacity-30 border border-blue-400 px-10 py-4 rounded-2xl font-bold hover:bg-opacity-40 transition flex items-center justify-center">
                <i class="fas fa-user-tie ml-2"></i> وظّف محترفين
            </a>
        </div>
    </section>

    <section class="py-20 container mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-12">
            <div class="text-center md:text-right mb-6 md:mb-0">
                <h2 class="text-3xl font-black text-slate-800">أحدث الكفاءات</h2>
                <p class="text-slate-500 mt-2">نخبة من المبدعين السودانيين انضموا إلينا مؤخراً</p>
            </div>
            <a href="employee_listing_page.html" class="group bg-white border border-slate-200 px-6 py-3 rounded-xl font-bold text-slate-700 hover:border-blue-600 hover:text-blue-600 transition flex items-center">
                عرض كافة الموظفين <i class="fas fa-arrow-left mr-3 group-hover:-translate-x-2 transition-transform"></i>
            </a>
        </div>
        
        <div id="home-employees-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <div class="col-span-full text-center py-12">
                <div class="inline-block animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent"></div>
                <p class="mt-4 text-slate-500 font-medium">جاري تحديث القائمة...</p>
            </div>
        </div>
    </section>

    <footer class="bg-slate-900 text-white pt-20 pb-10">
        <div class="container mx-auto px-6 text-center">
            <div class="text-3xl font-black text-blue-400 mb-6">شغلني</div>
            <p class="text-slate-400 max-w-md mx-auto mb-10">المنصة الأولى لدعم وتوظيف الكوادر السودانية وبناء مستقبل مهني أفضل للجميع.</p>
            <div class="flex justify-center gap-6 mb-12">
                <a href="#" class="text-2xl hover:text-blue-400 transition"><i class="fab fa-facebook"></i></a>
                <a href="#" class="text-2xl hover:text-blue-400 transition"><i class="fab fa-linkedin"></i></a>
                <a href="#" class="text-2xl hover:text-blue-400 transition"><i class="fab fa-instagram"></i></a>
            </div>
            <div class="border-t border-slate-800 pt-8 text-slate-500 text-sm">
                &copy; 2026 شغلني - جميع الحقوق محفوظة
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBsIaCjE7QOQ6QkhqhCIMA3sLdMvxBxPHk",
            authDomain: "shaglni-c64c0.firebaseapp.com",
            projectId: "shaglni-c64c0",
            storageBucket: "shaglni-c64c0.firebasestorage.app",
            messagingSenderId: "768887356636",
            appId: "1:768887356636:web:11ec1d6991add3309c8819"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const container = document.getElementById('home-employees-container');

        async function fetchLatestEmployees() {
            try {
                // جلب آخر 4 موظفين تم تسجيلهم
                const q = query(collection(db, "employees"), orderBy("timestamp", "desc"), limit(4));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    container.innerHTML = '<p class="col-span-full text-center text-slate-500">لا يوجد بيانات لعرضها حالياً.</p>';
                    return;
                }

                container.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const emp = doc.data();
                    const id = doc.id;
                    
                    const profileImg = emp.profileImageUrl || 'https://via.placeholder.com/150';
                    
                    // منطق جلب صور الأعمال من الحقل الصحيح previousWorksUrls
                    let portfolioHtml = '';
                    const workImages = emp.previousWorksUrls || [];

                    if (Array.isArray(workImages) && workImages.length > 0) {
                        portfolioHtml = `<div class="portfolio-mini-grid">`;
                        // عرض أول 3 صور أعمال فقط
                        workImages.slice(0, 3).forEach(url => {
                            portfolioHtml += `
                                <div class="portfolio-img-container">
                                    <img src="${url}" class="portfolio-img" loading="lazy" 
                                         onerror="this.src='https://via.placeholder.com/100?text=Work'">
                                </div>`;
                        });
                        portfolioHtml += `</div>`;
                    } else {
                        // حالة عدم وجود صور أعمال (مربعات فارغة أنيقة)
                        portfolioHtml = `
                            <div class="portfolio-mini-grid opacity-20">
                                <div class="portfolio-img-container bg-slate-200 border-dashed border-2"></div>
                                <div class="portfolio-img-container bg-slate-200 border-dashed border-2"></div>
                                <div class="portfolio-img-container bg-slate-200 border-dashed border-2"></div>
                            </div>`;
                    }

                    const card = `
                        <div class="employee-card">
                            <div class="text-center flex-grow">
                                <div class="relative inline-block mb-4">
                                    <img src="${profileImg}" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-md">
                                    <span class="absolute bottom-1 right-1 w-5 h-5 border-4 border-white rounded-full ${emp.jobStatus === 'متاح للعمل' ? 'bg-green-500' : 'bg-red-500'}"></span>
                                </div>
                                <h3 class="font-bold text-slate-800 text-lg mb-1 truncate">${emp.name || 'مستخدم'}</h3>
                                <p class="text-blue-600 text-sm font-semibold mb-4">${emp.headline || 'مبدع مستقل'}</p>
                                
                                <div class="flex flex-wrap justify-center gap-2 mb-4">
                                    ${Array.isArray(emp.skills) ? emp.skills.slice(0, 2).map(s => `<span class="skill-tag">${s}</span>`).join('') : ''}
                                </div>
                            </div>

                            ${portfolioHtml}

                            <div class="mt-4 pt-4 border-t border-slate-50 flex items-center justify-between">
                                <a href="chat.html?employeeId=${id}&employeeName=${encodeURIComponent(emp.name)}" 
                                   class="text-slate-400 hover:text-blue-600 transition p-2">
                                    <i class="far fa-comment-dots text-xl"></i>
                                </a>
                                <a href="employee_listing_page.html?search=${encodeURIComponent(emp.name)}" 
                                   class="bg-blue-600 text-white w-12 h-12 rounded-2xl flex items-center justify-center hover:bg-blue-700 transition shadow-lg shadow-blue-100">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (err) {
                console.error("Firebase Error:", err);
                container.innerHTML = '<p class="col-span-full text-center text-red-500">حدث خطأ في الاتصال بقاعدة البيانات.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', fetchLatestEmployees);
    </script>
</body>
</html>
