<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>
    <style>
        :root {
            --primary: #007bff;
            --shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            padding: 50px 20px;
        }

        .search-container {
            width: 100%;
            max-width: 550px;
            position: relative;
        }

        .input-wrapper {
            position: relative;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 2px solid transparent;
            transition: 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
        }

        input {
            width: 100%;
            padding: 18px 25px;
            border: none;
            outline: none;
            font-size: 18px;
            box-sizing: border-box;
        }

        .results-box {
            position: absolute;
            top: 110%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-height: 450px;
            overflow-y: auto;
            display: none;
            z-index: 999;
        }

        .uni-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: 0.2s;
        }

        .uni-item:hover {
            background-color: #f8f9fa;
        }

        .uni-logo {
            width: 45px;
            height: 45px;
            object-fit: contain;
            margin-left: 15px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #eee;
            padding: 2px;
        }

        .uni-details {
            display: flex;
            flex-direction: column;
        }

        .uni-name {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .uni-location {
            font-size: 13px;
            color: #777;
            margin-top: 3px;
        }

        .status-msg {
            padding: 20px;
            text-align: center;
            color: #666;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø¬Ù…ÙŠÙ„ Ù„Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .results-box::-webkit-scrollbar { width: 6px; }
        .results-box::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
    </style>
</head>
<body>

<div class="search-container">
    <div class="input-wrapper">
        <input type="text" id="uniInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø®Ø±Ø·ÙˆÙ…)..." autocomplete="off">
    </div>
    <div id="resultsBox" class="results-box"></div>
</div>

<script>
    const uniInput = document.getElementById('uniInput');
    const resultsBox = document.getElementById('resultsBox');
    let debounceTimer;

    uniInput.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        const query = uniInput.value.trim();

        if (query.length < 2) {
            resultsBox.style.display = 'none';
            return;
        }

        debounceTimer = setTimeout(() => fetchUniversities(query), 600);
    });

    async function fetchUniversities(query) {
        resultsBox.innerHTML = '<div class="status-msg">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª...</div>';
        resultsBox.style.display = 'block';

        // Ø§Ø³ØªØ¹Ù„Ø§Ù… SPARQL Ù…ØªØ·ÙˆØ±: ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Q2385804) Ø£Ùˆ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª (Q3918)
        const sparqlQuery = `
            SELECT DISTINCT ?item ?itemLabel ?logo ?countryLabel WHERE {
              ?item (wdt:P31/wdt:P279*) wd:Q2385804 . 
              ?item rdfs:label ?itemLabel .
              FILTER(CONTAINS(LCASE(?itemLabel), LCASE("${query}")))
              FILTER(LANG(?itemLabel) = "ar")
              OPTIONAL { ?item wdt:P154 ?logo . }
              OPTIONAL { ?item wdt:P17 ?country . ?country rdfs:label ?countryLabel . FILTER(LANG(?countryLabel) = "ar") }
              SERVICE wikibase:label { bd:serviceParam wikibase:language "ar". }
            } LIMIT 15
        `;

        const url = "https://query.wikidata.org/sparql?format=json&query=" + encodeURIComponent(sparqlQuery);

        try {
            const response = await fetch(url);
            const data = await response.json();
            renderResults(data.results.bindings);
        } catch (error) {
            resultsBox.innerHTML = '<div class="status-msg">Ø¹Ø°Ø±Ø§Ù‹ØŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©.</div>';
        }
    }

    function renderResults(universities) {
        if (universities.length === 0) {
            resultsBox.innerHTML = '<div class="status-msg">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¬Ø§Ù…Ø¹Ø§Øª Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù….</div>';
            return;
        }

        resultsBox.innerHTML = '';
        
        universities.forEach(u => {
            const name = u.itemLabel.value;
            const logo = u.logo ? u.logo.value.replace("http://", "https://") : 'https://cdn-icons-png.flaticon.com/512/807/807310.png';
            const country = u.countryLabel ? u.countryLabel.value : 'Ù…Ø¤Ø³Ø³Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ©';

            const div = document.createElement('div');
            div.className = 'uni-item';
            div.innerHTML = `
                <img src="${logo}" class="uni-logo" alt="logo">
                <div class="uni-details">
                    <span class="uni-name">${name}</span>
                    <span class="uni-location">ğŸ“ ${country}</span>
                </div>
            `;

            div.onclick = () => {
                uniInput.value = name;
                resultsBox.style.display = 'none';
            };
            resultsBox.appendChild(div);
        });
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-container')) resultsBox.style.display = 'none';
    });
</script>

</body>
</html>
