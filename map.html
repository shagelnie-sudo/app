<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختيار الموقع تلقائياً - مجاني</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; padding: 20px; text-align: right; }
        .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        /* قائمة الاقتراحات */
        #suggestions {
            position: absolute; width: 100%; background: white; border: 1px solid #ccc;
            max-height: 200px; overflow-y: auto; z-index: 1000; display: none;
            list-style: none; padding: 0; margin: 0;
        }
        #suggestions li { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 14px; }
        #suggestions li:hover { background-color: #f0f0f0; }
        
        input[readonly] { background-color: #f9f9f9; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <h3>تحديد العنوان تلقائياً</h3>
    
    <div class="form-group">
        <label>ابحث عن الموقع (مدينة أو حي أو شارع):</label>
        <input id="search" type="text" placeholder="ابدأ الكتابة هنا..." autocomplete="off">
        <ul id="suggestions"></ul>
    </div>

    <hr>

    <div class="form-group">
        <label>الولاية / المنطقة:</label>
        <input id="state" type="text" readonly>
    </div>

    <div class="form-group">
        <label>المدينة:</label>
        <input id="city" type="text" readonly>
    </div>

    <div class="form-group">
        <label>الحي / المنطقة الفرعية:</label>
        <input id="district" type="text" readonly>
    </div>
</div>

<script>
    const searchInput = document.getElementById('search');
    const suggestionsList = document.getElementById('suggestions');

    // دالة البحث عند الكتابة
    searchInput.addEventListener('input', function() {
        const query = this.value;
        if (query.length < 3) {
            suggestionsList.style.display = 'none';
            return;
        }

        // استخدام محرك بحث Nominatim (مجاني)
        fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&addressdetails=1&limit=5&accept-language=ar`)
            .then(response => response.json())
            .then(data => {
                suggestionsList.innerHTML = '';
                if (data.length > 0) {
                    suggestionsList.style.display = 'block';
                    data.forEach(place => {
                        const li = document.createElement('li');
                        li.textContent = place.display_name;
                        li.onclick = () => selectPlace(place);
                        suggestionsList.appendChild(li);
                    });
                }
            });
    });

    // دالة اختيار الموقع وتوزيع البيانات
    function selectPlace(place) {
        searchInput.value = place.display_name;
        suggestionsList.style.display = 'none';

        const addr = place.address;

        // ملء الحقول تلقائياً مع معالجة اختلاف التسميات
        document.getElementById('state').value = addr.state || addr.region || addr.province || "";
        document.getElementById('city').value = addr.city || addr.town || addr.municipality || addr.village || "";
        document.getElementById('district').value = addr.suburb || addr.neighbourhood || addr.residential || addr.quarter || "";
        
        console.log("Full Address Data:", addr);
    }

    // إغلاق القائمة عند النقر خارجها
    document.addEventListener('click', (e) => {
        if (e.target !== searchInput) suggestionsList.style.display = 'none';
    });
</script>

</body>
</html>
