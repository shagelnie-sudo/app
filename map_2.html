<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¯Ù‚ÙŠÙ‚</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; direction: rtl; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h3 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
        
        .gps-btn {
            background-color: #007bff; color: white; border: none; padding: 12px;
            border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 16px;
            transition: 0.3s; margin-bottom: 15px;
        }
        .gps-btn:hover { background-color: #0056b3; }

        #map { height: 350px; width: 100%; border-radius: 10px; border: 1px solid #ddd; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-size: 14px; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; background-color: #f9f9f9; font-size: 14px; }
        
        .coords-group { background: #eef9ff; padding: 15px; border-radius: 10px; grid-column: span 2; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; border: 1px inset #d1e9ff; }
        .coords-group input { background-color: #fff; color: #2c3e50; font-weight: bold; }
        
        #status { font-size: 13px; color: #007bff; margin-top: 10px; text-align: center; font-style: italic; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h3>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø§Ù„Ø¯Ù‚ÙŠÙ‚</h3>
    
    <button class="gps-btn" onclick="getLocation()">ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (GPS)</button>
    <div id="status">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©...</div>

    <div id="map"></div>

    <div class="info-grid">
        <div class="form-group">
            <label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label>
            <input id="state" type="text" readonly placeholder="...">
        </div>
        <div class="form-group">
            <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
            <input id="city" type="text" readonly placeholder="...">
        </div>
        <div class="form-group" style="grid-column: span 2;">
            <label>Ø§Ù„Ø­ÙŠ / Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ:</label>
            <input id="district" type="text" readonly placeholder="Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¯Ù‚ Ù…Ø³Ù…Ù‰ Ù„Ù„Ø­ÙŠ...">
        </div>

        <div class="coords-group">
            <div class="form-group">
                <label>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude):</label>
                <input id="lat" type="text" readonly>
            </div>
            <div class="form-group">
                <label>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude):</label>
                <input id="lng" type="text" readonly>
            </div>
        </div>
    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const map = L.map('map').setView([24.7136, 46.6753], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker = L.marker([24.7136, 46.6753]).addTo(map);

    function getLocation() {
        const status = document.getElementById('status');
        if (navigator.geolocation) {
            status.style.display = 'block';
            status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©...";
            
            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                
                updateInterface(lat, lng);
            }, () => {
                status.innerText = "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS.";
            });
        }
    }

    // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    map.on('click', function(e) {
        updateInterface(e.latlng.lat, e.latlng.lng);
    });

    function updateInterface(lat, lng) {
        // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ù…Ø¤Ø´Ø±
        map.setView([lat, lng], 16);
        marker.setLatLng([lat, lng]);

        // 2. ØªØ­Ø¯ÙŠØ« Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
        document.getElementById('lat').value = lat.toFixed(6);
        document.getElementById('lng').value = lng.toFixed(6);

        // 3. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (ØªØ­Ø³ÙŠÙ† Ø¬Ù„Ø¨ Ø§Ù„Ø­ÙŠ)
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&accept-language=ar`)
            .then(res => res.json())
            .then(data => {
                const addr = data.address;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆÙ„Ø§ÙŠØ© ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
                document.getElementById('state').value = addr.state || addr.region || addr.province || "";
                document.getElementById('city').value = addr.city || addr.town || addr.municipality || addr.village || "";

                // ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚ Ø¬Ù„Ø¨ Ø§Ù„Ø­ÙŠ (Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ÙƒØ§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ù…ÙƒÙ†Ø©)
                // ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­ÙŠ Ø§Ù„ØµØºÙŠØ± ÙˆÙŠÙ†ØªÙ‚Ù„ Ù„Ù„Ø£ÙƒØ¨Ø± Ø­ØªÙ‰ ÙŠØ¬Ø¯ Ù‚ÙŠÙ…Ø©
                const districtName = addr.neighbourhood || addr.suburb || addr.residential || addr.quarter || addr.subdistrict || addr.road || "ØºÙŠØ± Ù…Ø¹Ø±Ù Ø¨Ø¯Ù‚Ø©";
                document.getElementById('district').value = districtName;

                document.getElementById('status').innerText = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­";
                setTimeout(() => document.getElementById('status').style.display = 'none', 2000);
            });
    }
</script>

</body>
</html>
