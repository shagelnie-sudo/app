<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± GPS ÙˆØ§Ù„Ø®Ø±ÙŠØ·Ø©</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; padding: 20px; direction: rtl; }
        .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        
        /* Ø²Ø± GPS */
        .gps-btn {
            background-color: #27ae60; color: white; border: none; padding: 10px 15px;
            border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .gps-btn:hover { background-color: #219150; }

        #map { height: 300px; width: 100%; margin-top: 10px; border-radius: 8px; border: 2px solid #ddd; }
        
        .result-fields { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        input[readonly] { background-color: #f9f9f9; color: #d35400; font-weight: bold; }
        
        #loading { display: none; color: #2980b9; font-size: 14px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h3>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (GPS / Ø®Ø±ÙŠØ·Ø©)</h3>
    
    <button class="gps-btn" onclick="getLocation()">
        ğŸ“ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø§Ù„Ø¢Ù†
    </button>
    <div id="loading">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„...</div>

    <div id="map"></div>

    <div class="result-fields">
        <div class="form-group">
            <label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</label>
            <input id="state" type="text" readonly placeholder="ØªÙ„Ù‚Ø§Ø¦ÙŠ">
        </div>
        <div class="form-group">
            <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</label>
            <input id="city" type="text" readonly placeholder="ØªÙ„Ù‚Ø§Ø¦ÙŠ">
        </div>
        <div class="form-group">
            <label>Ø§Ù„Ø­ÙŠ:</label>
            <input id="district" type="text" readonly placeholder="ØªÙ„Ù‚Ø§Ø¦ÙŠ">
        </div>
    </div>
</div>

<script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    const map = L.map('map').setView([24.7136, 46.6753], 5); // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ù…Ø±ÙƒØ² Ø¹Ø§Ù… (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ø±ÙŠØ§Ø¶)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker = L.marker([24.7136, 46.6753]).addTo(map);

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± GPS
    function getLocation() {
        const loading = document.getElementById('loading');
        if (navigator.geolocation) {
            loading.style.display = 'block';
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ù…Ø¤Ø´Ø±
                    map.setView([lat, lng], 16);
                    marker.setLatLng([lat, lng]);
                    
                    // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù† Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
                    fetchReverseGeocode(lat, lng);
                },
                (error) => {
                    loading.style.display = 'none';
                    alert("ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù…ÙˆÙ‚Ø¹Ùƒ. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS ÙˆØ§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ØªØµÙØ­.");
                }
            );
        } else {
            alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø§Ù„ÙˆÙ„Ø§ÙŠØ©ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠ)
    function fetchReverseGeocode(lat, lng) {
        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&accept-language=ar`)
            .then(res => res.json())
            .then(data => {
                const addr = data.address;
                document.getElementById('state').value = addr.state || addr.region || "";
                document.getElementById('city').value = addr.city || addr.town || addr.municipality || "";
                document.getElementById('district').value = addr.suburb || addr.neighbourhood || addr.residential || "";
                
                document.getElementById('loading').style.display = 'none';
            })
            .catch(() => {
                document.getElementById('loading').style.display = 'none';
            });
    }

    // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠ Ø£ÙŠØ¶Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    map.on('click', function(e) {
        marker.setLatLng(e.latlng);
        fetchReverseGeocode(e.latlng.lat, e.latlng.lng);
    });
</script>

</body>
</html>
