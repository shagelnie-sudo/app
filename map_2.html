<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #0ea5e9;
            --bg: #f8fafc;
            --text: #1e293b;
        }

        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background-color: var(--bg); 
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .card {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            text-align: center;
        }

        .content { padding: 25px; }

        .btn-gps {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-gps:hover { opacity: 0.9; transform: translateY(-1px); }

        #map { 
            height: 300px; 
            width: 100%; 
            border-radius: 15px; 
            border: 1px solid #e2e8f0;
            margin-bottom: 25px;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .full-width { grid-column: span 2; }

        .input-box { display: flex; flex-direction: column; gap: 8px; }

        label { font-size: 14px; font-weight: 600; color: #64748b; }

        input {
            padding: 12px;
            border: 2px solid #f1f5f9;
            border-radius: 10px;
            background: #f8fafc;
            font-size: 15px;
            color: var(--text);
            transition: border-color 0.2s;
        }

        input:focus { border-color: var(--secondary); outline: none; }
        
        input[readonly] { color: var(--primary); font-weight: 500; }

        .coords-section {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 12px;
            margin-top: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .grid-layout { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h2 style="margin:0">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</h2>
        <p style="margin:10px 0 0; opacity:0.8">Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¨Ø¯Ù‚Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª</p>
    </div>

    <div class="content">
        <button class="btn-gps" onclick="getLocation()">
            <span>ğŸ“</span> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        </button>

        <div id="map"></div>

        <div class="grid-layout">
            <div class="input-box">
                <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label>
                <input id="state" type="text" readonly placeholder="---">
            </div>
            
            <div class="input-box">
                <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                <input id="city" type="text" readonly placeholder="---">
            </div>

            <div class="input-box full-width">
                <label>Ø§Ù„Ø­ÙŠ / Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØµÙÙŠ</label>
                <input id="district" type="text" readonly placeholder="Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­ÙŠ">
            </div>

            <div class="coords-section full-width">
                <div class="input-box">
                    <label>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Lat)</label>
                    <input id="lat" type="text" readonly>
                </div>
                <div class="input-box">
                    <label>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Lng)</label>
                    <input id="lng" type="text" readonly>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const map = L.map('map').setView([24.7136, 46.6753], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    let marker = L.marker([24.7136, 46.6753]).addTo(map);

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                updateInterface(position.coords.latitude, position.coords.longitude);
            });
        }
    }

    map.on('click', function(e) {
        updateInterface(e.latlng.lat, e.latlng.lng);
    });

    function updateInterface(lat, lng) {
        map.setView([lat, lng], 16);
        marker.setLatLng([lat, lng]);
        document.getElementById('lat').value = lat.toFixed(6);
        document.getElementById('lng').value = lng.toFixed(6);

        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1&accept-language=ar`)
            .then(res => res.json())
            .then(data => {
                const addr = data.address;
                
                document.getElementById('state').value = addr.state || addr.region || "";
                document.getElementById('city').value = addr.city || addr.town || addr.municipality || "";

                // ØªÙ†Ù‚ÙŠØ© Ø§Ù„Ø­ÙŠ Ù…Ù† Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ù…Ø«Ù„ a1 Ø£Ùˆ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø¬Ø±Ø¯Ø©
                let rawDistrict = addr.neighbourhood || addr.suburb || addr.residential || addr.quarter || addr.road || "";
                
                // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ø¬Ø±Ø¯ Ø±Ù…Ø² (Ø£Ù‚Ù„ Ù…Ù† 3 Ø£Ø­Ø±Ù Ø£Ùˆ ØªØ­ØªÙˆÙŠ Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)
                if (rawDistrict.length <= 2 || /^\d+$/.test(rawDistrict)) {
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¨Ø¯ÙŠÙ„ Ø£Ùˆ ØªØ±ÙƒÙ‡ Ù„Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹
                    rawDistrict = addr.road || "Ù…Ù†Ø·Ù‚Ø© Ø³ÙƒÙ†ÙŠØ©";
                }
                
                document.getElementById('district').value = rawDistrict;
            });
    }
</script>

</body>
</html>
